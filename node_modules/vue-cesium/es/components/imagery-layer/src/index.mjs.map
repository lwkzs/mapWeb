{"version":3,"file":"index.mjs","sources":["../../../../../../packages/components/imagery-layer/src/index.ts"],"sourcesContent":["/*\n * @Author: zouyaoji@https://github.com/zouyaoji\n * @Date: 2021-09-16 09:28:13\n * @LastEditTime: 2023-07-27 21:08:13\n * @LastEditors: zouyaoji 370681295@qq.com\n * @Description:\n * @FilePath: \\vue-cesium@next\\packages\\components\\imagery-layer\\src\\index.ts\n */\nimport { createCommentVNode, defineComponent, getCurrentInstance, h, VNode } from 'vue'\nimport type {\n  AnyFunction,\n  VcColor,\n  VcComponentInternalInstance,\n  VcComponentPublicInstance,\n  VcImageryProvider,\n  VcReadyObject,\n  VcRectangle\n} from '@vue-cesium/utils/types'\nimport { hSlot } from '@vue-cesium/utils/private/render'\nimport { useCommon } from '@vue-cesium/composables'\nimport defaultProps from './defaultProps'\nimport { getInstanceListener } from '@vue-cesium/utils/private/vm'\nimport { isUndefined, kebabCase } from '@vue-cesium/utils/util'\nimport { commonEmits } from '@vue-cesium/utils/emits'\nimport { compareCesiumVersion } from '@vue-cesium/utils/cesium-helpers'\n\nconst emits = {\n  ...commonEmits,\n  'update:imageryProvider': (payload: VcImageryProvider) => true,\n  readyEvent: (payload: VcImageryProvider) => true,\n  errorEvent: (payload: Error) => true\n}\nexport const imageryLayerProps = defaultProps\nexport default defineComponent({\n  name: 'VcLayerImagery',\n  props: imageryLayerProps,\n  emits: emits,\n  setup(props: VcLayerImageryProps, ctx) {\n    // state\n    const instance = getCurrentInstance() as VcComponentInternalInstance\n    instance.cesiumClass = 'ImageryLayer'\n    instance.cesiumEvents = ['readyEvent', 'errorEvent']\n    const commonState = useCommon(props, ctx, instance)\n    if (commonState === void 0) {\n      return\n    }\n    const { $services } = commonState\n    const { emit } = ctx\n    // methods\n    instance.createCesiumObject = async () => {\n      const options = commonState.transformProps(props)\n\n      if (compareCesiumVersion(Cesium.VERSION, '1.104')) {\n        const imageryProvider = (props.imageryProvider ||\n          Cesium.BingMapsImageryProvider.fromUrl(undefined, {\n            key: ''\n          })) as Cesium.ImageryProvider\n\n        const imageryLayer = Cesium.ImageryLayer.fromProviderAsync(imageryProvider as any, options as any)\n        imageryLayer.errorEvent.addEventListener(error => {\n          // console.log(error)\n        })\n\n        return imageryLayer\n      } else {\n        const imageryProvider = (props.imageryProvider || {}) as Cesium.ImageryProvider\n        return new Cesium.ImageryLayer(imageryProvider, options as any)\n      }\n    }\n\n    instance.mount = async () => {\n      const { viewer } = $services\n      const imageryLayer = instance.cesiumObject as Cesium.ImageryLayer\n      imageryLayer.sortOrder = props.sortOrder\n      imageryLayer.vcId = props.vcId || Cesium.createGuid()\n      viewer.imageryLayers.add(imageryLayer)\n      return !viewer.isDestroyed() && viewer.imageryLayers.contains(imageryLayer)\n    }\n\n    instance.unmount = async () => {\n      const { viewer } = $services\n      const imageryLayer = instance.cesiumObject as Cesium.ImageryLayer\n      return !viewer.isDestroyed() && viewer.imageryLayers.remove(imageryLayer)\n    }\n\n    const updateProvider = (provider: VcImageryProvider) => {\n      if (isUndefined(provider)) {\n        return instance.unmount?.()\n      } else {\n        const imageryLayer = instance.cesiumObject as Cesium.ImageryLayer\n        ;(imageryLayer as any)._imageryProvider = provider\n        const listener = getInstanceListener(instance, 'update:imageryProvider')\n        if (listener) emit('update:imageryProvider', provider)\n      }\n\n      return true\n    }\n\n    // expose public methods\n    Object.assign(instance.proxy, {\n      // private but needed by VcProviderXXX\n      __updateProvider: updateProvider\n    })\n\n    return () =>\n      ctx.slots.default\n        ? h(\n            'i',\n            {\n              class: kebabCase(instance.proxy?.$options.name || ''),\n              style: { display: 'none !important' }\n            },\n            hSlot(ctx.slots.default)\n          )\n        : createCommentVNode(kebabCase(instance.proxy?.$options.name || 'v-if'))\n  }\n})\n\nexport type LayerPropCallback = (frameState: any, layer: Cesium.ImageryLayer, x: number, y: number, level: number) => number\nexport type VcLayerImageryEmits = typeof emits\nexport type VcLayerImageryProps = {\n  /**\n   * The imagery provider to use.\n   */\n  imageryProvider?: VcImageryProvider\n  /**\n   * The rectangle of the layer. This rectangle can limit the visible portion of the imagery provider.\n   */\n  rectangle?: VcRectangle\n  /**\n   * The alpha blending value of this layer, from 0.0 to 1.0. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the alpha is required, and it is expected to return the alpha value to use for the tile.\n   * Default value: 1.0\n   */\n  alpha?: number | LayerPropCallback\n  /**\n   * The alpha blending value of this layer on the night side of the globe, from 0.0 to 1.0. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the alpha is required, and it is expected to return the alpha value to use for the tile. This only takes effect when enableLighting is true.\n   * Default value: 1.0\n   */\n  nightAlpha?: number | LayerPropCallback\n  /**\n   * The alpha blending value of this layer on the day side of the globe, from 0.0 to 1.0. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the alpha is required, and it is expected to return the alpha value to use for the tile. This only takes effect when enableLighting is true.\n   * Default value: 1.0\n   */\n  dayAlpha?: number | LayerPropCallback\n  /**\n   * The brightness of this layer. 1.0 uses the unmodified imagery color. Less than 1.0 makes the imagery darker while greater than 1.0 makes it brighter. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the brightness is required, and it is expected to return the brightness value to use for the tile. The function is executed for every frame and for every tile, so it must be fast.\n   * Default value: 1.0\n   */\n  brightness?: number | LayerPropCallback\n  /**\n   * The contrast of this layer. 1.0 uses the unmodified imagery color. Less than 1.0 reduces the contrast while greater than 1.0 increases it. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the contrast is required, and it is expected to return the contrast value to use for the tile. The function is executed for every frame and for every tile, so it must be fast.\n   * Default value: 1.0\n   */\n  contrast?: number | LayerPropCallback\n  /**\n   * The hue of this layer. 0.0 uses the unmodified imagery color. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the hue is required, and it is expected to return the contrast value to use for the tile. The function is executed for every frame and for every tile, so it must be fast.\n   * Default value: 0.0\n   */\n  hue?: number | LayerPropCallback\n  /**\n   * The saturation of this layer. 1.0 uses the unmodified imagery color. Less than 1.0 reduces the saturation while greater than 1.0 increases it. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the saturation is required, and it is expected to return the contrast value to use for the tile. The function is executed for every frame and for every tile, so it must be fast.\n   * Default value: 1.0\n   */\n  saturation?: number | LayerPropCallback\n  /**\n   * The gamma correction to apply to this layer. 1.0 uses the unmodified imagery color. This can either be a simple number or a function with the signature function(frameState, layer, x, y, level). The function is passed the current frame state, this layer, and the x, y, and level coordinates of the imagery tile for which the gamma is required, and it is expected to return the gamma value to use for the tile. The function is executed for every frame and for every tile, so it must be fast.\n   * Default value: 1.0\n   */\n  gamma?: number | LayerPropCallback\n  /**\n   * The SplitDirection split to apply to this layer.\n   */\n  splitDirection?: number | Cesium.SplitDirection | AnyFunction<number | Cesium.SplitDirection>\n  /**\n   * The texture minification filter to apply to this layer. Possible values are TextureMinificationFilter.LINEAR and TextureMinificationFilter.NEAREST.\n   */\n  minificationFilter?: number | Cesium.TextureMinificationFilter\n  /**\n   * The texture minification filter to apply to this layer. Possible values are TextureMagnificationFilter.LINEAR and TextureMagnificationFilter.NEAREST.\n   */\n  magnificationFilter?: number | Cesium.TextureMagnificationFilter\n  /**\n   * True if the layer is shown; otherwise, false.\n   * Default value: true\n   */\n  show?: boolean\n  /**\n   * The maximum anisotropy level to use for texture filtering. If this parameter is not specified, the maximum anisotropy supported by the WebGL stack will be used. Larger values make the imagery look better in horizon views.\n   */\n  maximumAnisotropy?: number\n  /**\n   * The minimum terrain level-of-detail at which to show this imagery layer, or undefined to show it at all levels. Level zero is the least-detailed level.\n   */\n  minimumTerrainLevel?: number\n  /**\n   * The maximum terrain level-of-detail at which to show this imagery layer, or undefined to show it at all levels. Level zero is the least-detailed level.\n   */\n  maximumTerrainLevel?: number\n  /**\n   * Cartographic rectangle for cutting out a portion of this ImageryLayer.\n   */\n  cutoutRectangle?: VcRectangle\n  /**\n   * Color to be used as alpha.\n   */\n  colorToAlpha?: VcColor\n  /**\n   * Threshold for color-to-alpha.\n   * Default value: 0.004\n   */\n  colorToAlphaThreshold?: number\n  /**\n   * Specify the relative order of the layer.\n   */\n  sortOrder?: number\n  /**\n   * Specify vcId of the layer.\n   */\n  vcId?: string\n  /**\n   * Triggers before the VcLayerImagery is loaded.\n   */\n  onBeforeLoad?: (instance: VcComponentInternalInstance) => void\n  /**\n   * Triggers when the VcLayerImagery is successfully loaded.\n   */\n  onReady?: (readyObject: VcReadyObject) => void\n  /**\n   * Triggers when the component load failed.\n   */\n  onUnready?: (e: any) => void\n  /**\n   * Triggers when the VcLayerImagery is destroyed.\n   */\n  onDestroyed?: (instance: VcComponentInternalInstance) => void\n  /**\n   * Triggers when imageryProvider is updated.\n   */\n  'onUpdate:imageryProvider'?: (payload: VcImageryProvider) => void\n}\n\nexport interface VcLayerImageryRef extends VcComponentPublicInstance<VcLayerImageryProps> {\n  /**\n   * private but needed by VcProviderXXX\n   * @param provider\n   */\n  __updateProvider?(provider: VcImageryProvider | undefined): boolean\n}\n\nexport interface VcLayerImagerySlots {\n  /**\n   * Slot for vc-imagery-provider-xxx.\n   */\n  default: () => VNode[]\n}\n"],"names":[],"mappings":"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"}