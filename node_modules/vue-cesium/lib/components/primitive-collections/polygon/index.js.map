{"version":3,"file":"index.js","sources":["../../../../../../packages/components/primitive-collections/polygon/index.ts"],"sourcesContent":["/*\n * @Author: zouyaoji@https://github.com/zouyaoji\n * @Date: 2021-11-19 22:09:27\n * @LastEditTime: 2022-08-25 21:31:00\n * @LastEditors: zouyaoji\n * @Description:\n * @FilePath: \\vue-cesium@next\\packages\\components\\primitive-collections\\polygon\\index.ts\n */\nimport type { WatchStopHandle } from 'vue'\nimport { createCommentVNode, defineComponent, getCurrentInstance, onUnmounted, watch } from 'vue'\nimport type {\n  VcPickEvent,\n  VcAppearance,\n  VcCartesian3Array,\n  VcComponentInternalInstance,\n  VcPolygonHierarchy,\n  VcReadyObject,\n  VcComponentPublicInstance\n} from '@vue-cesium/utils/types'\nimport { usePrimitiveCollectionItems } from '@vue-cesium/composables'\nimport {\n  id,\n  show,\n  enableMouseEvent,\n  positions,\n  arcType,\n  classificationType,\n  polygonHierarchy,\n  clampToGround,\n  appearance,\n  depthFailAppearance,\n  ellipsoid,\n  allowPicking,\n  asynchronous\n} from '@vue-cesium/utils/cesium-props'\nimport { kebabCase } from '@vue-cesium/utils/util'\nimport { PolygonPrimitive } from '@vue-cesium/shared'\nimport { makeAppearance, makeCartesian3Array, makePolygonHierarchy } from '@vue-cesium/utils/cesium-helpers'\nimport { primitiveCollectionEmits } from '@vue-cesium/utils/emits'\n\nexport const polygonProps = {\n  ...positions,\n  ...polygonHierarchy,\n  ...appearance,\n  ...depthFailAppearance,\n  ...show,\n  ...id,\n  ...arcType,\n  ...classificationType,\n  ...clampToGround,\n  ...ellipsoid,\n  ...allowPicking,\n  ...asynchronous,\n  ...enableMouseEvent\n}\nexport default defineComponent({\n  name: 'VcPolygon',\n  props: polygonProps,\n  emits: primitiveCollectionEmits,\n  setup(props, ctx) {\n    // state\n    const instance = getCurrentInstance() as VcComponentInternalInstance\n    instance.cesiumClass = 'PolygonPrimitive'\n    const primitiveCollectionItemsState = usePrimitiveCollectionItems(props, ctx, instance)\n\n    if (primitiveCollectionItemsState === void 0) {\n      return\n    }\n\n    // watcch\n    let unwatchFns: Array<WatchStopHandle> = []\n    unwatchFns.push(\n      watch(\n        () => props.clampToGround,\n        val => {\n          const polygonPrimitive = instance.cesiumObject as PolygonPrimitive\n          polygonPrimitive && (polygonPrimitive.clampToGround = val as boolean)\n        }\n      )\n    )\n    unwatchFns.push(\n      watch(\n        () => props.positions,\n        val => {\n          const polygonPrimitive = instance.cesiumObject as PolygonPrimitive\n          polygonPrimitive && (polygonPrimitive.positions = makeCartesian3Array(val!) as Array<Cesium.Cartesian3>)\n        }\n      )\n    )\n\n    unwatchFns.push(\n      watch(\n        () => props.polygonHierarchy,\n        val => {\n          const polygonPrimitive = instance.cesiumObject as PolygonPrimitive\n          polygonPrimitive && (polygonPrimitive.polygonHierarchy = makePolygonHierarchy(val!) as Cesium.PolygonHierarchy)\n        }\n      )\n    )\n\n    unwatchFns.push(\n      watch(\n        () => props.appearance,\n        val => {\n          const polygonPrimitive = instance.cesiumObject as PolygonPrimitive\n          polygonPrimitive && (polygonPrimitive.appearance = makeAppearance.call(instance, val!) as Cesium.Appearance)\n        }\n      )\n    )\n\n    unwatchFns.push(\n      watch(\n        () => props.depthFailAppearance,\n        val => {\n          const polygonPrimitive = instance.cesiumObject as PolygonPrimitive\n          polygonPrimitive && (polygonPrimitive.depthFailAppearance = makeAppearance.call(instance, val!) as Cesium.Appearance)\n        }\n      )\n    )\n\n    unwatchFns.push(\n      watch(\n        () => props.show,\n        val => {\n          const polygonPrimitive = instance.cesiumObject as PolygonPrimitive\n          polygonPrimitive && (polygonPrimitive.show = val)\n        }\n      )\n    )\n\n    unwatchFns.push(\n      watch(\n        () => props.classificationType,\n        val => {\n          const polygonPrimitive = instance.cesiumObject as PolygonPrimitive\n          polygonPrimitive && (polygonPrimitive.classificationType = val as number)\n        }\n      )\n    )\n\n    // methods\n    instance.createCesiumObject = async () => {\n      const options = primitiveCollectionItemsState.transformProps(props)\n      return new PolygonPrimitive(options)\n    }\n\n    instance.mount = async () => {\n      const primitives = primitiveCollectionItemsState.$services.primitives\n      const collectionItem = instance.cesiumObject\n      ;(collectionItem as any)._vcParent = primitives\n      return primitives && primitives.add(collectionItem)\n    }\n\n    instance.unmount = async () => {\n      const primitives = primitiveCollectionItemsState.$services.primitives\n      const collectionItem = instance.cesiumObject\n      return primitives && !primitives.isDestroyed() && primitives.remove(collectionItem)\n    }\n\n    // life cycle\n    onUnmounted(() => {\n      unwatchFns.forEach(item => item())\n      unwatchFns = []\n    })\n\n    return () => createCommentVNode(kebabCase(instance.proxy?.$options.name || ''))\n  }\n})\n\nexport type VcPolygonProps = {\n  /**\n   * A user-defined object to return when the instance is picked with Scene#pick or get/set per-instance attributes with Primitive#getGeometryInstanceAttributes.\n   */\n  id?: any\n  /**\n   * Determines if this primitive will be shown.\n   * Default value: true\n   */\n  show?: boolean\n  /**\n   * Specify the positions.\n   */\n  positions?: VcCartesian3Array\n  /**\n   * \tA polygon hierarchy that can include holes.\n   */\n  polygonHierarchy?: VcPolygonHierarchy\n  /**\n   * The type of line the polygon edges must follow. Valid options are ArcType.GEODESIC and ArcType.RHUMB.\n   */\n  arcType?: number | Cesium.ArcType\n  /**\n   * An enum Property specifying whether this polygon will classify terrain, 3D Tiles, or both when on the ground.\n   */\n  classificationType?: number | Cesium.ClassificationType\n  /**\n   * Specify whether the polygon is attached to the ground or 3dtiles.\n   */\n  clampToGround?: boolean\n  /**\n   * The appearance used to render the primitive.\n   */\n  appearance?: VcAppearance\n  /***\n   * The appearance used to shade this primitive when it fails the depth test.\n   */\n  depthFailAppearance?: VcAppearance\n  /**\n   * The ellipsoid to be used as a reference.\n   */\n  ellipsoid?: Cesium.Ellipsoid\n  /**\n   * When true, each geometry instance will only be pickable with Scene#pick. When false, GPU memory is saved.\n   * Default value: true\n   */\n  allowPicking?: boolean\n  /**\n   * Determines if the primitive will be created asynchronously or block until ready.\n   * Default value: true\n   */\n  asynchronous?: boolean\n  /**\n   * Specifies whether to respond to mouse pick events.\n   * Default Value: true\n   */\n  enableMouseEvent?: boolean\n  /**\n   * Triggers before the VcPolygon is loaded.\n   */\n  onBeforeLoad?: (instance: VcComponentInternalInstance) => void\n  /**\n   * Triggers when the VcPolygon is successfully loaded.\n   */\n  onReady?: (readyObject: VcReadyObject) => void\n  /**\n   * Triggers when the component load failed.\n   */\n  onUnready?: (e: any) => void\n  /**\n   * Triggers when the VcPolygon is destroyed.\n   */\n  onDestroyed?: (instance: VcComponentInternalInstance) => void\n  /**\n   * Triggers when the mouse is pressed on this polygon.\n   */\n  onMousedown?: (evt: VcPickEvent) => void\n  /**\n   * Triggers when the mouse bounces up on this polygon.\n   */\n  onMouseup?: (evt: VcPickEvent) => void\n  /**\n   * Triggers when the mouse clicks on this polygon.\n   */\n  onClick?: (evt: VcPickEvent) => void\n  /**\n   * Triggers when the mouse clicks outside this polygon.\n   */\n  onClickout?: (evt: VcPickEvent) => void\n  /**\n   * Triggers when the left mouse button double-clicks this polygon.\n   */\n  onDblclick?: (evt: VcPickEvent) => void\n  /**\n   * Triggers when the mouse moves on this polygon.\n   */\n  onMousemove?: (evt: VcPickEvent) => void\n  /**\n   * Triggers when the mouse moves over to this polygon.\n   */\n  onMouseover?: (evt: VcPickEvent) => void\n  /**\n   * Triggers when the mouse moves out of this polygon.\n   */\n  onMouseout?: (evt: VcPickEvent) => void\n}\n\nexport type VcPolygonRef = VcComponentPublicInstance<VcPolygonProps>\n"],"names":["positions","polygonHierarchy","appearance","depthFailAppearance","show","id","arcType","classificationType","clampToGround","ellipsoid","allowPicking","asynchronous","enableMouseEvent","defineComponent","primitiveCollectionEmits","getCurrentInstance","usePrimitiveCollectionItems","watch","makeCartesian3Array","makePolygonHierarchy","makeAppearance","PolygonPrimitive","onUnmounted","createCommentVNode","kebabCase"],"mappings":"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"}